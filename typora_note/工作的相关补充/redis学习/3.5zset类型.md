# Redis有序集合(sorted set)

redis 有序集合zset和集合set一样也是string类型元素的集合，且不允许重复的成员。

不同的是 zset 的每个元素都会关联一个分数（分数可以重复），redis 通过分数来为集合中的成员进行从小到大的排序。

## 基本命令

**A、zadd**

语法：zadd key score member [score member…]

作用：将一个或多个 member 元素及其 score 值加入到有序集合 key 中，如果 member

存在集合中，则更新值；score 可以是整数或浮点数

返回值：数字，新添加的元素个数

例 1：创建保存学生成绩的集合

![img](3.5zset类型.assets/1560738414@2afe3b60f120cb702564e1211221b03b.png)

例 2：使用浮点数作为 score

![img](3.5zset类型.assets/1560738628@34298d805f3066fc02a84df5aec97cb7.png)

**B、 zrange**

语法：zrange key start stop [WITHSCORES]

作用：查询有序集合，指定区间的内的元素。集合成员按 score 值从小到大来排序。 start，

stop 都是从 0 开始。0 是第一个元素，1 是第二个元素，依次类推。以 -1 表示最后一个成员，-2 表示倒数第二个成员。WITHSCORES 选项让 score 和 value 一同返回。

返回值：自定区间的成员集合

例 1：显示集合的全部元素，不显示 score，不使用 WITHSCORES

![img](3.5zset类型.assets/1560738768@288b9f7a0798430ed14cba27e9be9fbf.png)

例 2：显示集合全部元素，并使用 WITHSCORES

![img](3.5zset类型.assets/1560738804@4001f493d54af1f4887996a9a181e3fc.png)

例 3：显示第 0,1 二个成员

![img](3.5zset类型.assets/1560738860@d0e8b766c438f8d66c65f1376403cd7a.png)

例 4：排序显示浮点数的 score

![img](3.5zset类型.assets/1560738902@9f5a8e2ebdb85e76634094cbf1353a83.png)

**C、 zrevrange**

语法：zrevrange key start stop [WITHSCORES]

作用：返回有序集 key 中，指定区间内的成员。其中成员的位置按 score 值递减(从大到小) 来排列。其它同 zrange 命令。

返回值：自定区间的成员集合

例 1：成绩榜

![img](3.5zset类型.assets/1560739009@d67b2d712b72be044503566c1ad31e1e.png)

**D、zrem**

语法：zrem key member [member…]

作用：删除有序集合 key 中的一个或多个成员，不存在的成员被忽略

返回值：被成功删除的成员数量，不包括被忽略的成员。

例 1：删除指定一个成员 wangwu

![img](3.5zset类型.assets/1560739067@31a98fa5407d3fe55be942aef41d9595.png)

**E、 zcard**

语法：zcard key

作用：获取有序集 key 的元素成员的个数

返回值：key 存在返回集合元素的个数， key 不存在，返回 0

例 1：查询集合的元素个数

![img](3.5zset类型.assets/1560739163@2a14a4ce540688d8fa322edd1caebe0e.png)

## 常用命令

**A、zrangebyscore**

语法：zrangebyscore key min max [WITHSCORES ] [LIMIT offset count]

作用：获取有序集 key 中，所有 score 值介于 min 和 max 之间（包括 min 和 max）的成员，有序成员是按递增（从小到大）排序。

min ,max 是包括在内 ， 使用符号 ( 表示不包括。 min ， max 可以使用 -inf 

+inf 表示最小和最大

limit 用来限制返回结果的数量和区间。

withscores 显 示 score 和 value

返回值：指定区间的集合数据

使用的准备数据

![img](3.5zset类型.assets/1560739282@3542132257be7b5d96c0757feb24c78c.png)

例 1：显示指定具体区间的数据

![img](3.5zset类型.assets/1560739365@93272667aba47ef6168a43bc0bdb256c.png)

例 2：显示指定具体区间的集合数据，开区间（不包括 min，max）

![img](3.5zset类型.assets/1560739402@50a9e0c2e001f53025f22b0a72d3d28e.png)

例 3：显示整个集合的所有数据

![img](3.5zset类型.assets/1560739441@0c7794013f46344e2565bbe1a828b893.png)

例 4：使用 limit

增加新的数据：

![img](3.5zset类型.assets/1560739499@c2fa4cf1b3cfc69fd08529da47662f51.png)

![img](3.5zset类型.assets/1560739512@c48f411fd6f90ae5f7d783c371b08cbc.png)

显示从第一个位置开始，取一个元素。

![img](3.5zset类型.assets/1560739550@4f27c30396cc3f698781c74213ca7565.png)

**B、 zrevrangebyscore**

语法：zrevrangebyscore key max min [WITHSCORES ] [LIMIT offset count]

作用：返回有序集 key 中， score 值介于 max 和 min 之间(默认包括等于 max 或 min )的所有的成员。有序集成员按 score 值递减(从大到小)的次序排列。其他同 zrangebyscore

例 1：查询工资最高到 3000 之间的员工

![img](3.5zset类型.assets/1560739604@03f27fe52be63bc034110ea957107183.png)

**C、 zcount**

语法：zcount key min max

作用：返回有序集 key 中， score 值在 min 和 max 之间(默认包括 score 值等于 min 或 max )的成员的数量

例 1：求工资在 3000-5000 的员工数量

![img](3.5zset类型.assets/1560739665@c4e8442fe74d2d7f671f640010ddbb87.png)

# 应用场景

#### 销售排行

```
商品销售排行。【Sort Zset】
抖音热搜。
例：key 为goods:sellsort，分数为销售数量
```

![image-20210322142829912](3.5zset类型.assets/image-20210322142829912.png)

#### 抖音热搜

![在这里插入图片描述](3.5zset类型.assets/20210203160035227.png)

```
# 点击视频
127.0.0.1:6379>zincrby hotvcr:20200919 1 八佰
127.0.0.1:6379>zincrby hotvcr:20200919 1 八佰 2 花木兰
# 展示当日排行前10
127.0.0.1:6379>zrange hotvrc:20200919 0 9 withscores

```

