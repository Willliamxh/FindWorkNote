# From Local to Global: A Graph Framework for Retinal Artery/Vein Classification

## Abstract

摘要眼底摄影已经被眼科医生或计算机算法广泛应用于眼科疾病的检查。与视网膜血管相关的生物标志物对早期糖尿病的检测起着至关重要的作用。为了量化血管生物标志物或相应的变化，一个准确的动脉和静脉分类是必要的。在这项工作中，我们提出了一个新的框架来提高局部血管分类与全局血管网络模型使用图卷积。在马斯特里赫特研究的750幅图像测试数据集上，我们将我们提出的方法与两种最先进的传统方法进行了比较。在融合了全局信息后，我们的模型获得了86.45%的最佳准确率，而卷积神经网络(CNN)和手工像素特征分类(HPFC)的准确率分别为85.5%和82.9%。我们的模型还得到了接收机工作特性曲线下的最佳面积为0.95,CNN为0.93,HPFC为0.90。新的分类框架具有在本地分类特性之上易于部署的优点。它通过最小化全局分类误差来修正局部分类误差，并带来免费的附加分类性能。



## Introduction

### background

DR的严重程度与显微动脉瘤、出血和新生血管[16]等病理模式密切相关。在这种情况下，数字图像处理技术可以通过识别这些异常模式和测量它们的生长来协助疾病检测，并对DR阶段进行自动分级，以便制定治疗计划。然而，通过分析[41]视网膜上的血管，及早发现DR也是可行的。如视网膜动静脉血管管径/宽[28]、迂曲[5]、[19]及分形维数[2]、[12]、[13]、[24]改变已被证明是评估糖尿病疾病的重要指标。摘要在**视网膜图像中建立基于动静脉的自动测量方法，对动静脉进行自动分类是一个重要的步骤，对眼科医生处理大量的筛查图像有很大的帮助。**



### Related Work

  在过去，经常提出两种类型的自动化方法来解决这个分类问题。一种是基于图的构造。Dashtbozorg等人[8]采用了一种基于图形的自动经典方法。Joshi等[30]使用Dijkstra s图搜索算法将血管段作为子树进行连接，并将其聚类为动脉类和静脉类。Hu等[22]采用基于图和元启发式算法构建了血管结构。Estrada等人[15]将领域特有特征与拓扑框架结合起来，构建了a /V分类的全局似然模型。另一种方法是基于像素分类。Joshi et al.， Niemeijer et al.， Hu et al.， Mirsharif et al.， Xu et al.和我们所提出的方法[2]，[12]，[13]，[24]，[30]，[37]提取大量(少数到数百个)用于表征动静脉的特征并进行分类。通常在分类前采用特征选择技术来提高分类性能。

  最近，深度学习已经成为一种非常流行的解决识别问题的方法，涉及[20]，[29]，[33]，[39]，[40]多个领域。深度卷积神经网络(CNN)旨在自动检测和识别物体，而不使用手工制作的特征。特征的学习是通过大量数据的误差反向传播来实现的。在各种物体识别任务(例如ImageNet竞赛)中，它的表现超过了传统的机器学习技术，甚至超过了人类的观察能力。在视网膜图像分析领域，CNN已经用于血管分割[31]，动/静脉分类[42]，DR预测[18]，[38]。



将CNN应用于A/V分类具有挑战性。在**视网膜图像的纹理图案中，动脉和静脉的差别非常小**。主分支上的中心反射可能是最强的指示器（The central reflection on the main branch might be the strongest indicator）。因此，结构非常深的神经网络不一定能提高分类性能。除此之外，直接**起源于视盘(OD)的大的动静脉在外观上有明显的差异，而小的甚至一些中等大小的动静脉在较低的分支水平上几乎是一样的**。因此，仅提供小块的血管段，完全依靠卷积网络来区分动脉和静脉几乎是不可能的。**图1**左侧两幅图显示两条血管相交，一条是动脉，另一条是静脉。然而，他们几乎一样的外观，即使是一个非常有经验的眼科医生也不能作出鉴别。

<img src="从局部到全局一个图形框架 视网膜动脉或静脉分类.assets/image-20201104095046217.png" alt="image-20201104095046217" style="zoom: 33%;" />

*图1 这些示例图像斑块表明，仅利用局部邻域提取的基于强度的特征来区分动脉和静脉是不够的。而当我们追溯血管看它们的父母时，我们可以立即识别出动脉和静脉。左边的两幅图像是局部patch，与右边的绿色矩形对应。*

然而，当我们查看一个更大的视场并追溯到它们的父分支(右边的绿色矩形的图形)时，我们立即识别出了差异。这个例子说明了应用图知识的重要性，也提高了将图结构与传统CNN架构相结合以获得更好、更健壮性能的兴趣。在本文中，据我们所知，我们是第一个提出了将传统CNN架构与图卷积网络相结合的图框架。



## METHODOLOGY

### Overview

摘要视网膜图像常出现局部亮度和对比度变化，其主要原因是图像的不均匀性照明和不规则的视网膜表面。如果使用原始图像，会严重干扰正确的图像分析。为了克服这种光照变化，首先对光照变化[17]进行校正，然后采用[3]、[35]、[43]自动分割技术对血管进行分割。在这项工作中，我们使用了来自[43]的方法。接下来，我们构建一个视网膜血管树的全局图表示，它包含四个元素:顶点、顶点权重、边和边权重。它可以基于视网膜图像和相应的血管二值图，以血管为前景，以视网膜组织为背景来构建。提取血管图后，通过形态学细化得到血管中心线。在骨架化图中，出现分支和交叉点的连接区域被移除，从而使血管彼此断开并单独处理。然后，根据这些分离的血管段构造一个图，将血管的结构特征和局部强度特征结合起来。图中的每个顶点代表一个血管段，并由一个特征矢量来表征用于血管分割。任意两个顶点之间的每条边都表示两个向量之间的连接强度。最后，将该图作为图卷积网络(GCNet)的输入，该网络为图卷积网络的所有顶点分配动脉或静脉标签(图2)。

### Graph Construction

#### 1) Vertex and Edge Construction：

去除血管重叠区域后，将整个血管树建模为一个图形G=（V，E）其中顶点V=｛V1，V2，……，Vi｝，边表示为：<img src="从局部到全局一个图形框架 视网膜动脉或静脉分类.assets/image-20201104103040687.png" alt="image-20201104103040687" style="zoom: 67%;" />

图中每个顶点vi表示一条血管中心线线段，每个边ei→j表示从vi到v j的连接。其中右箭头'→'表示有向边。每条边的权值wi→j∈(0,1)，表示来自容器vi和v j的连接强度。使用有向边是因为在A/V分类中，大血管比小血管更具描述性，而且它们更可靠(例如对局部光照变化不太敏感)。所以更大的可能较小的弱连接而较小的应该有强烈的连接到更大的给wi→j  = wj→我。当vi和v j连接到相同的重叠区域时，计算wi→j，否则将其设置为零，使两段之间没有直接连接

#### 2) Edge Weight Measurement

边ei→j上的边权值wi→j表示容器vi到v j的连接强度。It is determined by three factors:(1) the **continuity** from vessel vi and v j ;(2) the **vessel width difference** between vi and v j (3) the **distance-to-OD difference** between vi and v j .



**Continuity:**

冠脉连通性分析的目的是估计被交叉或分叉打断的两个分离的部分是否属于同一血管（The vessel connectivity analysis aims to estimate if two separated segments, being broken by crossings or bifurcations, belong to the same vessel）。它测量移动一个线段到另一个线段时空间位置和方向的变化。Consider **vessel segment vi** = (xi, θi ) and v j = (x j, θj ) where **xi is the spatial position** and **θi is the orientation of vessel** (between 0 and 2π), and **d(vi, v j ) is a distance metric** that quantifies the difference between vi and v j .d(vi, v j)越小，vi和v j由于连续性而相互连接的可能性越大。

<img src="从局部到全局一个图形框架 视网膜动脉或静脉分类.assets/image-20201104162450984.png" alt="image-20201104162450984" style="zoom:50%;" />

然而，L2-norm没有考虑关节vi和v j缺失路径的光滑性，因此不能区分如图3所示的难解情况。

<img src="从局部到全局一个图形框架 视网膜动脉或静脉分类.assets/image-20201104162623762.png" alt="image-20201104162623762" style="zoom:50%;" />

*图3 红色箭头和绿色箭头的欧几里得距离和角度差(x0，前0)相同，直观上绿色箭头比红色箭头更近，因为它的行进路径更平滑。数据取自[4]。*

  在图3中，红色箭头v1 = (x1, wo1)和绿色箭头v2 = (x2, wo2)到原点的空间距离和角度距离相等v0 = (x0, wo0)(黑色箭头)。所以| bbbv1 - v0 b| = ||v2 - v0||。但v1、v2和v0之间的测地线最小路径的弧长不同，直观上绿色路径略短于红色路径。因此，在这个意义上，v2比v1更有可能连接到v0。

然后写了一堆新的测距离的方法。

**Vessel width:**

The width of each vessel segment is measured by the method introduced in [25], which is based on the Geodesic Active Contour technique [6].

**Distance to optic disc**



总结:理想情况下，连接度较高、血管宽度较大、离OD-center较近的相邻段vj对vj段的决策影响较大，需要确定这三个测量值的权重。在本研究中，我们基于血管结构构造了三个具有相同图结构的图，边权分别为连通性、宽度差和距离差。将这三个图导入网络(在图卷积模块之前)，网络通过反向传播学习三个测量值的最优线性组合。



#### C. Graph Convolutional Network

















